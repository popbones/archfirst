<!DOCTYPE html>

<!--
Questions:
1. How to turn a series on and off using a LegendRenderer instead of checkboxes
   (see http://groups.google.com/group/jqplot-users/browse_thread/thread/372ab3ef2e6021c0)
2. How to animate a series when turning it on or off?
3. How to create a horizontal legend?
4. How to create a second dimension for sectors (currently using listbox)?
-->

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Charting Library Comparison - jqPlot</title>
    <!--[if lt IE 9]><script type="text/javascript" src="/libs/jquery-jqplot-1.0.0b2/excanvas.js"></script><![endif]-->

    <link rel="stylesheet" type="text/css" href="../../libs/style4/css/style4.css" />
    <link rel="stylesheet" type="text/css" href="../../libs/jqplot/jquery-jqplot-1.0.0b2/jquery.jqplot.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css" />

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
    <script type="text/javascript" src="/libs/jquery-jqplot-1.0.0b2/jquery.jqplot.js"></script>
    <script type="text/javascript" src="/libs/jquery-jqplot-1.0.0b2/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="/libs/jquery-jqplot-1.0.0b2/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
    <script type="text/javascript" src="/libs/jquery-jqplot-1.0.0b2/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script type="text/javascript" src="/libs/jquery-jqplot-1.0.0b2/plugins/jqplot.cursor.min.js"></script>
    <script type="text/javascript" src="/libs/jquery-jqplot-1.0.0b2/plugins/jqplot.dateAxisRenderer.min.js"></script>
    <script type="text/javascript" src="/libs/jquery-jqplot-1.0.0b2/plugins/jqplot.highlighter.min.js"></script>

    <script type="text/javascript">

        var sectors = {};
        var sectorNames = [];

        $(document).ready(function () {
            $.jqplot.config.enablePlugins = true;

            // Initialize p&l data by sectors
            $.ajax({
                // have to use synchronous here, else the function 
                // will return before the data is fetched
                async: false,
                url: "cumulative-pnl-weekly-by-sector.json",
                dataType: "json",
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        var sector = getSector(data[i].sector);
                        sector.marketMoves.push([data[i].week, data[i].marketMoves]);
                        sector.newTrades.push([data[i].week, data[i].newTrades]);
                        sector.fees.push([data[i].week, data[i].fees]);
                        sector.total.push([data[i].week, data[i].total]);
                    }
                }
            });

            // Create sector names and populate in sector listbox
            var options = "";
            var selected = ' selected="selected"';
            for (var sectorName in sectors) {
                sectorNames.push(sectorName);
                options += '<option value="' + sectorName + '"' + selected + '>' + sectorName + '</option>';
                selected = "";  // clear selected after first time through the loop
            }
            $('#sectorList').html(options);

            // Plot first sector
            var plot1 = $.jqplot('chart1', [sectors[sectorNames[0]].marketMoves, sectors[sectorNames[0]].newTrades, sectors[sectorNames[0]].fees, sectors[sectorNames[0]].total], {
                title: {
                    text: 'Cumulative Trading P&L YTD'
                },
                seriesDefaults: {
                    show: true,
                    showLabel: true,
                    showMarker: false
                },
                series: [
                    { label: 'Market Moves' },
                    { label: 'New Trades' },
                    { label: 'Fees and commissions' },
                    { label: 'Total' }
                ],
                axesDefaults: {
                    tickOptions: {
                        fontSize: '8pt'
                    }
                },
                axes: {
                    xaxis: {
                        label: 'Week',
                        labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
                        tickOptions: {
                            formatString: '%d'
                        }
                    },
                    yaxis: {
                        label: '$ in thousands ($000\'s)',
                        labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
                        tickOptions: {
                            formatString: '$%d'
                        }
                    }
                },
                highlighter: {
                    show: true,
                    sizeAdjust: 7.5
                },
                cursor: {
                    show: true,
                    zoom: true,
                    showTooltip: false
                }
            });

            $('.legendVisibility').click(function () {
                var series_number = 0;
                switch (this.value) {
                    case "market-moves":
                        series_number = 0;
                        break;
                    case "new-trades":
                        series_number = 1;
                        break;
                    case "fees":
                        series_number = 2;
                        break;
                    case "total":
                        series_number = 3;
                        break;
                }
                plot1.series[series_number].show = this.checked;
                plot1.replot();
            });

            $('#sectorList').change(function () {
                plot1.series[0].data = sectors[this.value].marketMoves;
                plot1.series[1].data = sectors[this.value].newTrades;
                plot1.series[2].data = sectors[this.value].fees;
                plot1.series[3].data = sectors[this.value].total;
                plot1.resetAxesScale();
                plot1.replot();
            });

        });

        function getSector(name) {
            var sector = sectors[name];
            if (sector == null) {

                sector = new Object();
                sector.marketMoves = [];
                sector.newTrades = [];
                sector.fees = [];
                sector.total = [];

                sectors[name] = sector;
            }
            return sector;
        }
  </script>
</head>

<body>
<div id="wrapper">
    <h1>Trade Warehouse</h1>

    <div id="stylefour">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="cumulative-pnl-weekly-by-sector-jqplot.html" class="current">Cumulative P&L (jqPlot)</a></li>
            <li><a href="cumulative-pnl-weekly-by-sector-highcharts.html">Cumulative P&L (Highcharts)</a></li>
        </ul>
    </div>

    <div id="sidebar">
        <select id="sectorList" size="20"></select>
    </div>

    <div id="content">
        <div id="chart1"></div>

        <div id="legend1">
            <input class="legendVisibility" value="total" type="checkbox" checked="checked" /> <img src="images/marker-green.png" alt="cyan" /> Total&nbsp;&nbsp;
            <input class="legendVisibility" value="market-moves" type="checkbox" checked="checked" /> <img src="images/marker-cyan.png" alt="cyan" /> Market Moves&nbsp;&nbsp;
            <input class="legendVisibility" value="new-trades" type="checkbox" checked="checked" /> <img src="images/marker-gold.png" alt="cyan" /> New Trades&nbsp;&nbsp;
            <input class="legendVisibility" value="fees" type="checkbox" checked="checked" /> <img src="images/marker-khaki.png" alt="cyan" /> Fees and Commissions<br />
        </div>
    </div>
</div>
</body>
</html>
/**
* Copyright 2012 Archfirst
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

/**
* app-all
*
* @author Vikas Goyal
*/
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());Ext.define("Bullsfirst.extensions.SmartRestProxy",{extend:"Ext.data.proxy.Rest",alias:"proxy.smartrest",setException:function(b,a){b.response=a;b.setException({status:a.status,statusText:a.statusText})},buildUrl:function(d){var b="?";var c=this.queryParams;for(var a in c){if(!Ext.isEmpty(c[a])){if(b.indexOf("=")>1){b+="&"}b+=(a+"="+c[a])}}if(b!="?"){d.url=this.url+b}if(this.url.indexOf("/secure/")>0){this.headers={Authorization:Bullsfirst.GlobalFunctions.getAuthenticationHeader()}}return this.callParent(arguments)}});Ext.define("Bullsfirst.extensions.SmartRestProxy",{extend:"Ext.data.proxy.Rest",alias:"proxy.smartrest",setException:function(b,a){b.response=a;b.setException({status:a.status,statusText:a.statusText})},buildUrl:function(d){var b="?";var c=this.queryParams;for(var a in c){if(!Ext.isEmpty(c[a])){if(b.indexOf("=")>1){b+="&"}b+=(a+"="+c[a])}}if(b!="?"){d.url=this.url+b}if(this.url.indexOf("/secure/")>0){this.headers={Authorization:Bullsfirst.GlobalFunctions.getAuthenticationHeader()}}return this.callParent(arguments)}});Ext.define("Bullsfirst.store.AbstractStore",{extend:"Ext.data.Store",fields:[],listeners:{load:function(c,b,d){var a;if(d==true){var a=c.alias+"loaded"}else{var a=c.alias+"loadError"}EventAggregator.publish(a,c)}}});Ext.define("Bullsfirst.extensions.SmartFormPanel",{extend:"Ext.form.Panel",alias:"widget.smartform",bodyStyle:{background:"transparent"},initComponent:function(){this.on("afterrender",function(){var a=this.getForm();var b=this.down("submitbutton");if(a!=null&&b!=null){a.on("validitychange",function(){a.hasInvalidField()?b.disable():b.enable()},this);b.on("enable",function(){a.isValid()});a.getFields().each(function(c){c.on("specialkey",function(f,d){if(d.getKey()==d.ENTER){if(!b.isDisabled()){b.fireEvent("click",b)}}})})}},this);this.callParent()},resetAllFields:function(){var a=this.getForm();a.getFields().each(function(b){b.reset()});a.fireEvent("validitychange",a)}});Ext.define("Bullsfirst.GlobalConstants",{singleton:true,BaseUrl:"http://archfirst.org",Login:"Login",Edit:"Edit",GettingStarted:"Getting Started",SignOut:"Sign Out",PleaseLogin:"Please Login",OpenAccount:"Open an Account",OpenAccountButton:"Open Account",Update:"Update",AddAccount:"Add Account",PreviewOrder:"Preview Order",Transfer:"Transfer",Cancel:"Cancel",CreateBrokerageAccount:"Create New Account",EditBrokerageAccount:"Edit Account",CreateExternalAccount:"Add External Account",PreviewOrder:"Preview Order",AddExternalAccount:"Add an external account...",Transfer:"Transfer",BrokeageAccountDefaultName:"Brokerage Account 1",ExternalAccountDefaultName:"External Account 1",ExternalAccountDefaultRoutingNumber:22056782,ExternalAccountDefaultAccountNumber:12345678,DefaultTransferAmount:100000,InvalidDateMsg:"'To' date cannot be before 'From' date",AccountCreated:"Congratulations!",AccountReloginMsg:"Account Created! Please login using your new account",TradeMessage:"We love to trade, and we hope you do too. Now you can do it with the latest trading platform from Bullsfirst.  We guarantee  a  0-second trade execution, and will give you a free popsicle if your trade doesn't go through in this time period. On a side note, we just bought a big freezer and 10,000 popsicles. Thankfully, we've hedged all popsicle expenses for the next two years! (Commodity experts say popsicles are on the rise).",CopyrightMessage:"This is a demo application. All data displayed is fictitious. Copyright @ 2010-2012 <a href='http://archfirst.org/' target='new'>Archfirst</a>",LoadingMessage:"Please wait, Loading...",LoggingInMaskMessage:"Please wait, Logging in...",CreatingUserMaskMessage:"Please wait, Creating user...",ErrorTitle:"Error!",GeneralError:"The following error occurred while processing your request:</br>{0}",InvalidForm:"The form has errors. Please correct and try again",UnknownError:"An unknown error occurred while processing your request",StoreLoadError:"An error occurred while loading {0}",UserLoginError:"An error occurred while trying to login </br> {0}",CreateResourceError:"An error occurred while trying to create a {0} </br> {1}",EditResourceError:"An error occurred while trying to edit the {0} </br> {1}",CancelResourceError:"An error occurred while trying to cancel the {0} </br> {1}",RetrievedResourceError:"An error occurred while trying to retrieve the {0} </br> {1}"});Ext.define("Bullsfirst.GlobalFunctions",{singleton:true,getAuthenticationHeader:function getAuthenticationHeader(){var c=Ext.data.StoreManager.lookup("LoggedInUser").first();var a=c.get("username")+":"+c.get("password");var b=Base64.encode(a);return"Basic "+b},validateDate:function validateDate(b,a){if(a<b){return Bullsfirst.GlobalConstants.InvalidDateMsg}else{return true}},validateToDate:function validateToDate(b){try{var d=Ext.Date.parse(b,"m/d/Y");var a=this.ownerCt.down("datefield[fieldLabel=From]").getValue();return Bullsfirst.GlobalFunctions.validateDate(a,d)}catch(c){return true}},validateFromDate:function validateFromDate(b){try{var a=Ext.Date.parse(b,"m/d/Y");var d=this.ownerCt.down("datefield[fieldLabel=To]").getValue();return Bullsfirst.GlobalFunctions.validateDate(a,d)}catch(c){return true}},formatDate:function(b){var a=Ext.Date.parse(b,"Y-m-dTH:i:s.uP");return Ext.Date.format(a,"m-d-Y h:i:s A")}});Ext.define("Bullsfirst.model.Position",{extend:"Ext.data.Model",fields:[{name:"accountName",type:"string"},{name:"accountId",type:"int"},{name:"instrumentName",type:"string"},{name:"instrumentSymbol",type:"string"},{name:"quantity",type:"int"},{name:"lastTrade",convert:function convertToAmount(a){if(Ext.isObject(a)&&a.amount!=undefined){return a.amount}return a}},{name:"marketValue",convert:function convertToAmount(b,a){if(Ext.isObject(b)&&b.amount!=undefined){return b.amount}return b}},{name:"pricePaid",convert:function convertToAmount(a){if(Ext.isObject(a)&&a.amount!=undefined){return a.amount}return a}},{name:"totalCost",convert:function convertToAmount(a){if(Ext.isObject(a)&&a.amount!=undefined){return a.amount}return a}},{name:"gain",convert:function convertToAmount(a){if(Ext.isObject(a)&&a.amount!=undefined){return a.amount}return a}},{name:"gainPercent",type:"float"},{name:"lotCreationTime",type:"string"},{name:"iconCls",convert:function(a){return"no-icon"}},{name:"leaf",convert:function(b,a){var c=a.get("children");if(c==null||c.length==0){return true}return false}},{name:"buyAction",convert:function(b,a){if(a.get("leaf")==false){return'<a href="#">Buy</a>'}else{return" "}}},{name:"sellAction",convert:function(b,a){if(a.get("leaf")==false){return'<a href="#">Sell</a>'}else{return" "}}}],belongsTo:"Bullsfirst.model.BrokerageAccountSummary"});Ext.define("Bullsfirst.model.BrokerageAccountSummary",{extend:"Ext.data.Model",fields:[{name:"cashPosition",convert:function(b,a){return b.amount}},{name:"marketValue",convert:function(b,a){return b.amount}},{name:"editPermission",type:"bool"},{name:"tradePermission",type:"bool"},{name:"transferPermission",type:"bool"},{name:"name",type:"string"},{name:"id",type:"int"},{name:"fullname",convert:function(b,a){return a.get("name")+" - "+ +a.get("id")+" - "+Ext.util.Format.usMoney(a.get("cashPosition"))}}],associations:[{type:"hasMany",model:"Bullsfirst.model.Position",name:"positions"}],proxy:{type:"smartrest",url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/brokerage_accounts"}});Ext.define("Bullsfirst.model.TradeOrderType",{extend:"Ext.data.Model",fields:[{name:"OrderTypeName",type:"string"}]});Ext.define("Bullsfirst.model.TradeAction",{extend:"Ext.data.Model",fields:[{name:"ActionName",type:"string"}]});Ext.define("Bullsfirst.model.User",{extend:"Ext.data.Model",fields:[{name:"firstName",type:"string"},{name:"lastName",type:"string"},{name:"username",type:"string"},{name:"password",type:"string"}],idProperty:"username",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/users"}});Ext.define("Bullsfirst.model.BrokerageAccount",{extend:"Ext.data.Model",fields:[{name:"accountName",type:"string"}],idProperty:"accountName",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/brokerage_accounts"}});Ext.define("Bullsfirst.model.TradeTerm",{extend:"Ext.data.Model",fields:[{name:"TermName",type:"string"}]});Ext.define("Bullsfirst.model.Instrument",{extend:"Ext.data.Model",fields:[{name:"symbol",type:"string"},{name:"name",type:"string"},{name:"exchange",type:"string"},{name:"symbolFullName",convert:function(b,a){return a.get("symbol")+"    "+a.get("name")}}],proxy:{type:"smartrest",url:Bullsfirst.GlobalConstants.BaseUrl+"/bfexch-javaee/rest/instruments"}});Ext.define("Bullsfirst.view.trading.CreateBrokerageAccountView",{extend:"Ext.window.Window",alias:"widget.createBrokerageAccountView",requires:["Ext.window.MessageBox"],title:Bullsfirst.GlobalConstants.CreateBrokerageAccount,width:300,modal:true,autoHeight:true,closable:true,resizable:false,autoShow:false,layout:{type:"fit"},initComponent:function(){this.items=[{xtype:"smartform",items:[{xtype:"textfield",name:"accountName",margin:"5",width:250,allowBlank:false,fieldLabel:"Account Name",labelAlign:"top"}],buttons:[{text:"OK",minWidth:70,xtype:"submitbutton",itemId:"OkBtn"},{text:"Cancel",itemId:"CancelBtn"}]}];this.callParent()}});Ext.define("Bullsfirst.view.trading.AccountsView",{extend:"Ext.panel.Panel",alias:"widget.accountsview",initComponent:function initAccountsViewComponents(){var a={layout:{type:"hbox",align:"stretch"},margin:"0 20 0 20"};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function buildAccountsViewConfig(a){this.buildItems(a);this.buildToolbars(a);this.buildButtons(a)},buildItems:function buildAccountsViewItems(a){a.items=[this.buildGridPanelConfig(),this.buildChartPanelConfig()]},buildToolbars:function buildAccountsViewToolbars(a){a.dockedItems=[{xtype:"toolbar",dock:"top",ui:"footer",margin:"5 0 5 0",defaults:{minHeight:20,margin:"5 0 5 0"},padding:{left:2},items:[{text:Bullsfirst.GlobalConstants.Update},{xtype:"tbspacer"},{itemId:"AddAccountBtn",text:Bullsfirst.GlobalConstants.AddAccount,margin:"5 0 5 5"},{xtype:"tbfill"}]}]},buildButtons:function buildAccountsViewButtons(a){a.buttons=undefined},buildGridPanelConfig:function buildGridPanelConfig(){var a={xtype:"grid",style:{font:20},bodyStyle:{border:0,font:20},flex:1,plugins:["loadmask"],store:"BrokerageAccountSummaries",columns:[{xtype:"templatecolumn",text:"Name",flex:3,tpl:'<a href="#">{name}</a>',dataIndex:"name"},{text:"Account #",dataIndex:"id",flex:1.5,align:"right"},{text:"Market Value",dataIndex:"marketValue",flex:2,align:"right",renderer:Ext.util.Format.usMoney},{text:"Cash",dataIndex:"cashPosition",flex:1.5,align:"right",renderer:Ext.util.Format.usMoney},{xtype:"templatecolumn",text:"Actions",flex:1,align:"center",tpl:'<a href="#">Edit</a>'}]};return a},buildChartPanelConfig:function buildChartPanelConfig(){var a=Ext.data.StoreManager.lookup("BrokerageAccountSummaries");var b={xtype:"container",cls:"chartPanelCls",plugins:["loadmask"],store:a,flex:1,layout:"border",items:[{xtype:"container",html:"All Accounts",cls:"chartTitleCls",region:"north",height:60},{xtype:"chart",region:"center",animate:false,store:a,theme:"Base:gradients",legend:{position:"right",autoScroll:true},series:[{type:"pie",angleField:"cashPosition",showInLegend:true,tips:{trackMouse:true,width:140,height:28,renderer:function(e,d){var c=0;a.each(function(f){c+=f.get("cashPosition")});this.setTitle(e.get("name")+": "+(e.get("cashPosition")/c*100)+"%")}}}]}]};return b}});Ext.define("Bullsfirst.view.trading.PositionsView",{extend:"Ext.panel.Panel",alias:"widget.positionsview",initComponent:function initPositionsViewComponents(){var a={margin:"0 20 0 20",layout:{type:"hbox",align:"stretch"}};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function buildPositionsViewConfig(a){this.buildItems(a);this.buildToolbars(a);this.buildButtons(a)},buildItems:function buildPositionsViewItems(a){a.items=[this.buildGridPanelConfig()]},buildToolbars:function buildPositionsViewToolbars(a){a.dockedItems=[{xtype:"toolbar",dock:"top",ui:"footer",margin:"5 0 5 0",padding:{left:2},items:[{xtype:"button",text:Bullsfirst.GlobalConstants.Update},{xtype:"tbfill"},{xtype:"combo",margin:"0 5 0 0",plugins:["loadmask"],store:"BrokerageAccountSummaries",editable:false,displayField:"fullname",queryMode:"local",valueField:"id",width:300}]}]},buildButtons:function buildPositionsViewButtons(a){a.buttons=undefined},buildGridPanelConfig:function buildGridPanelConfig(){var a={xtype:"treepanel",bodyStyle:{border:0},plugins:["loadmask"],store:"PositionsTree",rootVisible:false,singleExpand:false,flex:1,columns:[{header:"Name",xtype:"treecolumn",sortable:false,menuDisabled:true,flex:3,dataIndex:"instrumentName",renderer:function(e,d,c){if(c.get("leaf")==true){var b=c.get("lotCreationTime");if(Ext.isEmpty(b)){return c.get("instrumentName")}this.align="left";return Bullsfirst.GlobalFunctions.formatDate(b)}else{return c.get("instrumentName")}}},{header:"Symbol",sortable:false,menuDisabled:true,flex:1,dataIndex:"instrumentSymbol"},{header:"Quantity",sortable:false,menuDisabled:true,dataIndex:"quantity",flex:1.5,align:"right",renderer:Bullsfirst.extensions.Format.quantity},{header:"Last Trade",sortable:false,menuDisabled:true,dataIndex:"lastTrade",flex:1.5,align:"right",renderer:Bullsfirst.extensions.Format.usMoney},{header:"Market Value",sortable:false,menuDisabled:true,dataIndex:"marketValue",flex:1.5,align:"right",renderer:Bullsfirst.extensions.Format.usMoney},{header:"Price Paid",sortable:false,menuDisabled:true,dataIndex:"pricePaid",flex:1.5,align:"right",renderer:Bullsfirst.extensions.Format.usMoney},{header:"Total Cost",sortable:false,menuDisabled:true,dataIndex:"totalCost",flex:1.5,align:"right",renderer:Bullsfirst.extensions.Format.usMoney},{header:"Gain",sortable:false,menuDisabled:true,dataIndex:"gain",flex:1.5,align:"right",renderer:Bullsfirst.extensions.Format.usMoney},{header:"Gain %",sortable:false,menuDisabled:true,dataIndex:"gainPercent",align:"right",flex:1.5,renderer:function(b){return Ext.util.Format.number(b*100,"0.00%")}},{xtype:"templatecolumn",cls:"templateColumnCls",sortable:false,align:"center",menuDisabled:true,header:"",flex:0.1,tpl:"{buyAction}"},{xtype:"templatecolumn",cls:"templateColumnCls",sortable:false,align:"center",menuDisabled:true,header:"",flex:0.1,tpl:"{sellAction}"}]};return a}});Ext.define("Bullsfirst.view.trading.TradingTabPanel",{extend:"Ext.tab.Panel",alias:"widget.tradingtabpanel",plain:true,loggedInUser:null,selectedBrokerageAccount:null,initComponent:function initTradingTabPanelComponents(){var a={plane:true,margin:"5 0 0 0"};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent();this.addTabBar()},buildConfig:function buildTradingTabPanelConfig(a){this.buildItems(a);this.buildToolbars(a);this.buildButtons(a)},buildItems:function buildTradingTabPanelItems(a){a.items=[this.addTab("Accounts","accountsview"),this.addTab("Positions","positionsview"),this.addTab("Trade","tradeview"),this.addTab("Orders","ordersview"),this.addTab("Transaction History","transactionsview"),this.addTab("Transfer","transferview")]},buildToolbars:function buildTradingTabPanelToolbars(a){a.dockedItems=undefined},addTabBar:function addTabBar(){var a=this.tabBar;a.add({xtype:"container",style:{border:0,background:"transparent"},flex:2,minHeight:21,layout:{type:"hbox",align:"stretch"},defaults:{margin:"3 5 0 0"},items:[{xtype:"container",flex:1},{xtype:"container",flex:1.5,items:[{xtype:"component",itemId:"gettingStartedLink",autoEl:{tag:"a",href:Bullsfirst.GlobalConstants.BaseUrl+"/books/getting-started",target:"new",html:Bullsfirst.GlobalConstants.GettingStarted},flex:1}]},{xtype:"container",flex:1,maxWidth:130,items:[{xtype:"label",itemId:"userName",text:"",margin:"4 5 0 0",flex:1},{xtype:"label",text:"|",flex:0.1},{xtype:"component",itemId:"signOutLink",margin:"4 0 0 5",autoEl:{tag:"a",href:"#",html:Bullsfirst.GlobalConstants.SignOut},flex:1}]}]})},buildButtons:function buildTradingTabPanelButtons(a){a.buttons=undefined},addTab:function addTab(b,a){return{title:b,layout:"border",items:[{xtype:"container",html:b,height:30,cls:"tabTitleCls",region:"north"},{xtype:a,region:"center"}]}}});Ext.define("Bullsfirst.view.trading.TradeView",{extend:"Ext.panel.Panel",alias:"widget.tradeview",initComponent:function initTradeViewComponents(){var a={};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function buildTradeViewConfig(a){this.buildItems(a);this.buildToolbars(a)},buildItems:function buildTradeViewItems(a){a.items=[this.buildFormPanelConfig()]},buildFormPanelConfig:function buildFormPanelConfig(){var a={xtype:"smartform",cls:"tradeFormCls",margin:"20 0 0 50",maxWidth:600,defaults:{enableKeyEvents:true,allowBlank:false,labelWidth:70,margin:"10 15 2 12",width:350}};this.buildFormPanelItems(a);this.buildFormPanelButtons(a);return a},buildFormPanelItems:function(a){a.items=[{fieldLabel:"Account",xtype:"combo",editable:false,plugins:["loadmask"],store:"BrokerageAccountSummaries",name:"accountName",displayField:"fullname",queryMode:"local",valueField:"id"},{xtype:"container",collapsible:false,width:600,layout:{type:"hbox",align:"stretch"},items:[{fieldLabel:"Symbol",xtype:"combo",allowBlank:false,name:"symbol",flex:1.05,maxWidth:350,minWidth:350,labelWidth:70,typeAhead:true,plugins:["loadmask"],store:"Instruments",queryMode:"local",displayField:"symbolFullName",valueField:"symbol"},{xtype:"displayfield",hidden:true,flex:1,fieldLabel:"Last Trade",name:"lastTrade",labelWidth:70,margin:"0 0 0 10",width:300,renderer:Ext.util.Format.usMoney}]},{fieldLabel:"Action",xtype:"combo",editable:false,name:"action",plugins:["loadmask"],store:"TradeActions",queryMode:"local",displayField:"ActionName",valueField:"ActionName"},{fieldLabel:"Quantity",xtype:"numberfield",name:"quantity",minValue:1,allowBlank:false},{fieldLabel:"Order Type",xtype:"combo",editable:false,name:"orderType",plugins:["loadmask"],store:"TradeOrderTypes",queryMode:"local",displayField:"OrderTypeName",valueField:"OrderTypeName"},{fieldLabel:"Term",xtype:"combo",editable:false,name:"term",plugins:["loadmask"],store:"TradeTerms",queryMode:"local",displayField:"TermName",valueField:"TermName"},{xtype:"checkbox",name:"allOrNone",margin:"8 0 0 86",boxLabel:"All-or-none"}]},buildToolbars:function buildTradeViewToolbars(a){a.dockedItems=undefined},buildFormPanelButtons:function buildFormPanelButtons(a){a.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",margin:"5 0 5 80",defaults:{minWidth:50,maxWidth:160},items:[{xtype:"submitbutton",text:Bullsfirst.GlobalConstants.PreviewOrder,flex:1}]}]}});Ext.define("Bullsfirst.view.trading.TransferView",{extend:"Ext.panel.Panel",alias:"widget.transferview",initComponent:function initTradeViewComponents(){var a={};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function buildTradeViewConfig(a){this.buildItems(a)},buildItems:function buildTradeViewItems(a){a.items=[this.buildFormPanelConfig()]},buildFormPanelConfig:function buildFormPanelConfig(){var a={xtype:"smartform",cls:"tradeFormCls",margin:"20 0 0 20",maxWidth:650,defaults:{enableKeyEvents:true,margin:"10 10 2 0",labelWidth:120,width:400}};this.buildFormPanelItems(a);this.buildFormPanelToolbars(a);return a},buildFormPanelItems:function(a){a.items=[{xtype:"radiogroup",maxWidth:200,margin:"0 0 0 100",items:[{boxLabel:"Cash",name:"instrumentType",margin:"0 5 1 20",checked:true,inputValue:"1"},{boxLabel:"Securities",name:"instrumentType",margin:"0 5 1 20",inputValue:"2"}]},{xtype:"combo",fieldLabel:"From",allowBlank:false,plugins:["loadmask"],store:"AllAccounts",editable:false,displayField:"fullname",queryMode:"local",valueField:"id"},{xtype:"combo",fieldLabel:"To",plugins:["loadmask"],store:"AllAccounts",allowBlank:false,editable:false,name:"toAccountId",displayField:"fullname",queryMode:"local",allowBlank:false,valueField:"id"},{xtype:"container",collapsible:false,margin:"10 10 2 20",transferType:"Securities",hidden:true,width:650,layout:{type:"hbox",align:"stretch"},items:[{xtype:"combo",fieldLabel:"Symbol",name:"symbol",typeAhead:true,plugins:["loadmask"],store:"Instruments",queryMode:"local",displayField:"symbolFullName",valueField:"symbol",flex:1.47,validator:this.hiddenFieldValidator},{xtype:"displayfield",flex:1,fieldLabel:"Last Trade",name:"lastTrade",labelWidth:70,margin:"0 0 0 10",width:300,renderer:Ext.util.Format.usMoney}]},{xtype:"numberfield",fieldLabel:"Quantity",name:"quantity",minValue:1,transferType:"Securities",hidden:true,validator:this.hiddenFieldValidator},{xtype:"numberfield",fieldLabel:"Price Paid Per Share",name:"pricePaidPerShare",minValue:1,transferType:"Securities",hidden:true,validator:this.hiddenFieldValidator},{xtype:"numberfield",fieldLabel:"Amount",minValue:1,name:"amount",transferType:"Cash",validator:this.hiddenFieldValidator}]},buildFormPanelToolbars:function buildTradeViewToolbars(a){a.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",margin:"0 0 0 120",defaults:{minWidth:50,maxWidth:150},items:[{xtype:"component",itemId:"createExternalAccountLink",autoEl:{tag:"a",href:"#",html:Bullsfirst.GlobalConstants.AddExternalAccount},flex:1}]},{xtype:"toolbar",dock:"bottom",ui:"footer",margin:"5 0 5 120",defaults:{minWidth:50,maxWidth:60},items:[{xtype:"submitbutton",text:Bullsfirst.GlobalConstants.Transfer,flex:1}]}]},hiddenFieldValidator:function(a){if(this.isVisible()&&Ext.isEmpty(a)){return"Please enter "+this.fieldLabel.toLowerCase()}else{return true}}});Ext.define("Bullsfirst.view.shared.MainContentPanel",{extend:"Ext.panel.Panel",alias:"widget.mainContentPanel",flex:1,layout:{type:"hbox",align:"stretch"},initComponent:function initLogInMainPanelComponents(){var a={};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function buildLogInMainPanelConfig(a){this.buildItems(a)},buildItems:function buildItems(a){a.items=[{width:650,layout:{type:"vbox",align:"stretch"},items:[{xtype:"image",margin:"20 60 20 60",maxHeight:200,flex:1,src:"resources/bullsfirst/images/homeGraphic.png"},{flex:1,bodyCls:"tradeMessageCls",height:210,maxWidth:607,margin:"5 0 0 10",html:Bullsfirst.GlobalConstants.TradeMessage}]},{xtype:"loginview",margin:"0 0 0 40",maxHeight:165,maxWidth:195,flex:1}]}});Ext.define("Bullsfirst.store.Positions",{extend:"Ext.data.Store",model:"Bullsfirst.model.Position"});Ext.define("Bullsfirst.store.BrokerageAccountSummaries",{extend:"Bullsfirst.store.AbstractStore",model:"Bullsfirst.model.BrokerageAccountSummary",alias:"brokerageaccountsstore"});Ext.define("Bullsfirst.model.TradeOrderSummary",{extend:"Ext.data.Model",fields:[{name:"id",type:"object"},{name:"creationTime",type:"string"},{name:"side",type:"string"},{name:"symbol",type:"string"},{name:"quantity",type:"int"},{name:"cumQty",type:"int"},{name:"type",type:"string"},{name:"term",type:"string"},{name:"allOrNone",type:"bool"},{name:"status",type:"string"},{name:"action",convert:function(b,a){if(a!=null&&a.get("status")=="New"){return"Cancel"}else{return" "}}},{name:"limitPrice",convert:function(b,a){if(Ext.isObject(b)){return b.amount}else{return b}}},{name:"executions",type:"array"},{name:"iconCls",convert:function(a){return"no-icon"}},{name:"leaf",convert:function(b,a){var c=a.get("executions");if(c==null||c.length==0){return true}return false}},{name:"price",type:"object"},{name:"executionPrice",convert:function(f,b){var e=b.get("price");if(e!=null&&e.amount!=null){return e.amount}var d=b.get("executions");if(Ext.isArray(d)){var a=0;for(var c=0;c<d.length;c++){if(d[c].price!=null&&d[c].price.amount!=null){a+=d[c].price.amount}}return a}}}]});Ext.define("Bullsfirst.view.trading.TransactionsView",{extend:"Ext.panel.Panel",alias:"widget.transactionsview",initComponent:function initPositionsViewComponents(){var a={margin:"0 20 0 20"};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function buildPositionsViewConfig(a){this.buildItems(a);this.buildToolbars(a);this.buildButtons(a)},buildItems:function buildPositionsViewItems(a){a.items=[this.buildGridPanelConfig()]},buildToolbars:function buildPositionsViewToolbars(a){a.dockedItems=[{xtype:"toolbar",dock:"top",ui:"footer",margin:"5 0 5 0",padding:{left:2,bottom:1},items:[{xtype:"tbfill"},{xtype:"combo",width:300,editable:false,plugins:["loadmask"],store:"BrokerageAccountSummaries",displayField:"fullname",queryMode:"local",valueField:"id"}]},{xtype:"toolbar",dock:"top",margin:"5 0 5 5",ui:"footer",padding:{left:2,top:5,bottom:1},items:[{xtype:"datefield",width:140,fieldLabel:"From",value:new Date(),labelWidth:35,validator:Bullsfirst.GlobalFunctions.validateFromDate},{xtype:"datefield",width:140,labelWidth:35,value:new Date(),fieldLabel:"To",validator:Bullsfirst.GlobalFunctions.validateToDate},{xtype:"tbfill"},{text:"Update"},{text:"Reset Filter"}]}]},buildButtons:function buildPositionsViewButtons(a){a.buttons=undefined},buildGridPanelConfig:function buildGridPanelConfig(){var a={xtype:"grid",plugins:["loadmask"],bodyStyle:{border:0},plugins:["loadmask"],store:"Transactions",flex:1,columns:[{header:"Creation Time",xtype:"datecolumn",flex:3,dataIndex:"creationTime",renderer:function(b){return Bullsfirst.GlobalFunctions.formatDate(b)}},{header:"Type",flex:1,dataIndex:"type"},{header:"Description",flex:5,dataIndex:"description"},{header:"Amount",dataIndex:"amount",flex:1.5,align:"right",renderer:Bullsfirst.extensions.Format.usMoney},{header:"",flex:5}]};return a}});Ext.define("Bullsfirst.store.BrokerageAccounts",{extend:"Ext.data.Store",model:"Bullsfirst.model.BrokerageAccount"});Ext.define("Bullsfirst.store.Instruments",{extend:"Bullsfirst.store.AbstractStore",model:"Bullsfirst.model.Instrument",alias:"instrumentsstore"});Ext.define("Bullsfirst.store.TradeActions",{extend:"Ext.data.Store",model:"Bullsfirst.model.TradeAction",data:[{ActionName:"Buy"},{ActionName:"Sell"}]});Ext.define("Bullsfirst.store.TradeOrderSummaries",{extend:"Bullsfirst.store.AbstractStore",model:"Bullsfirst.model.TradeOrderSummary",alias:"ordersstore",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/orders",reader:{type:"json"}}});Ext.define("Bullsfirst.store.TradeTerms",{extend:"Ext.data.Store",model:"Bullsfirst.model.TradeTerm",data:[{TermName:"GoodForTheDay"},{TermName:"GoodTilCanceled"}]});Ext.define("Bullsfirst.store.PositionsTree",{extend:"Ext.data.TreeStore",model:"Bullsfirst.model.Position",treeField:"instrumentName",groupField:"instrumentSymbol",data:null,root:{expanded:true,loaded:false},proxy:{type:"memory",reader:{type:"json",root:"children"}}});Ext.define("Bullsfirst.store.TradeOrderTypes",{extend:"Ext.data.Store",model:"Bullsfirst.model.TradeOrderType",data:[{OrderTypeName:"Market"},{OrderTypeName:"Limit"}]});Ext.define("Bullsfirst.model.Transaction",{extend:"Ext.data.Model",fields:[{name:"accountId",type:"int"},{name:"accountName",type:"string"},{name:"transactionId",type:"int"},{name:"creationTime",type:"string"},{name:"type",type:"string"},{name:"description",type:"string"},{name:"amount",convert:function(b,a){return b.amount}}],idPropety:"transactionId",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/transactions"}});Ext.define("Bullsfirst.model.EditBrokerageAccount",{extend:"Ext.data.Model",fields:[{name:"name",persist:false,convert:function(b,a){a.set("newName",b);return b}},{name:"newName",type:"string"}],idProperty:"newName",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/accounts/{0}/change_name"}});Ext.define("Bullsfirst.view.Viewport",{extend:"Ext.container.Viewport",layout:{type:"hbox",align:"stretch"},autoScroll:true,cls:"viewportCls",loadMask:new Ext.LoadMask(this,{msg:Bullsfirst.GlobalConstants.LoadingMessage}),initComponent:function initAccountsViewComponents(){var a={};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function buildViewportConfig(a){this.buildItems(a)},buildItems:function buildItems(a){a.items=[this.buildLeftColumnConfig(),this.buildCenterColumnConfig(),this.buildRightColumnConfig()]},buildLeftColumnConfig:function buildLeftColumnConfig(){var a={xtype:"container",cls:"mainLayoutStyle",flex:1};return a},buildRightColumnConfig:function buildRightColumnConfig(){var a={xtype:"container",cls:"mainLayoutStyle",flex:1};return a},buildCenterColumnConfig:function buildCenterColumnConfig(){var a={xtype:"panel",cls:"centerPanelCls",layout:{type:"vbox",align:"stretch"},width:970};this.buildCenterColumnItems(a);this.buildCenterColumnFooter(a);return a},buildCenterColumnItems:function buildCenterColumnItems(a){a.items=[{xtype:"panel",cls:"logoPanelCls",height:99,bodyStyle:{background:"#B30000"},margin:"25 0 0 0",dockedItems:[{xtype:"toolbar",ui:"logotoolbar",style:{border:0},height:95,items:[{xtype:"image",src:"resources/bullsfirst/images/logo.jpg"},{xtype:"tbfill"},{xtype:"image",src:"resources/bullsfirst/images/slogan.jpg",margin:"0 -5 0 0"}]}]},{xtype:"mainContentPanel",margin:"5 0 0 0",itemId:"mainContentRegion",flex:1}]},buildCenterColumnFooter:function buildCenterColumnFooter(a){a.dockedItems=[{xtype:"toolbar",ui:"logotoolbar",dock:"bottom",padding:"5 0 0 0",style:{border:0},height:23,items:[{xtype:"tbfill"},{xtype:"displayfield",fieldBodyCls:"footerCls",value:Bullsfirst.GlobalConstants.CopyrightMessage},{xtype:"tbfill"}]}]}});Ext.define("Bullsfirst.view.trading.EditBrokerageAccountView",{extend:"Ext.window.Window",alias:"widget.editbrokerageaccountview",title:Bullsfirst.GlobalConstants.EditBrokerageAccount,width:300,modal:true,autoHeight:true,closable:true,resizable:false,autoShow:false,layout:{type:"fit"},initComponent:function(){this.items=[{xtype:"smartform",items:[{xtype:"textfield",name:"accountName",margin:"5",name:"name",width:250,allowBlank:false,fieldLabel:"Account Name",labelAlign:"top"}],buttons:[{text:"OK",minWidth:70,xtype:"submitbutton",itemId:"OkBtn"},{text:"Cancel",itemId:"CancelBtn"}]}];this.callParent()}});Ext.define("Bullsfirst.view.accounts.CreateAccountView",{extend:"Ext.window.Window",alias:"widget.createaccountview",initComponent:function(){var a={layout:"fit",modal:true,resizable:false,width:265,height:320,title:"Open an Account",items:[this.buildConfig()]};this.buildCustomVType();Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildCustomVType:function(){Ext.apply(Ext.form.field.VTypes,{passwordConfirm:function(d,c){var b=c.up("smartform");var a=b.down("textfield[fieldLabel="+c.siblingPasswordField+"]");if(!Ext.isEmpty(c.rawValue)&&!Ext.isEmpty(a.rawValue)){if(a.rawValue!=c.rawValue){return false}else{return true}}else{return true}},passwordConfirmText:"Passwords don't match"})},buildConfig:function(){var a={xtype:"smartform",layout:"anchor",defaultType:"textfield",defaults:{labelAlign:"top",enableKeyEvents:true,margin:"5 10 5 10",width:230,allowBlank:false}};this.buildItems(a);this.buildButtons(a);return a},buildItems:function(a){a.items=[{name:"firstName",blankText:"Please enter your first name",fieldLabel:"First Name"},{name:"lastName",blankText:"Please enter your last name",fieldLabel:"Last Name"},{name:"username",blankText:"Please enter your username",fieldLabel:"Username"},{name:"password",blankText:"Please enter your password",fieldLabel:"Password",vtype:"passwordConfirm",siblingPasswordField:"Confirm Password",inputType:"password"},{fieldLabel:"Confirm Password",blankText:"Please confirm your password",siblingPasswordField:"Password",vtype:"passwordConfirm",inputType:"password"}]},buildButtons:function(a){this.buildFormPanelButtons(a)},buildFormPanelButtons:function(a){a.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",height:40,items:[{xtype:"tbfill"},{xtype:"submitbutton",text:Bullsfirst.GlobalConstants.OpenAccountButton,action:"openAccount",width:100},{text:Bullsfirst.GlobalConstants.Cancel,action:"cancel",width:80}]}]}});Ext.define("Bullsfirst.store.Transactions",{extend:"Bullsfirst.store.AbstractStore",model:"Bullsfirst.model.Transaction",alias:"transactionsstore"});Ext.define("Bullsfirst.view.trading.CreateExternalAccountView",{extend:"Ext.window.Window",alias:"widget.createexternalaccountview",title:Bullsfirst.GlobalConstants.CreateExternalAccount,width:280,modal:true,autoHeight:true,closable:true,resizable:false,autoShow:false,layout:{type:"fit"},initComponent:function(){this.items=[{xtype:"smartform",items:[{xtype:"textfield",name:"name",margin:"5 5 5 8",width:250,allowBlank:false,fieldLabel:"Account Name",labelAlign:"top"},{xtype:"numberfield",name:"routingNumber",margin:"5 5 5 8",width:250,allowBlank:false,fieldLabel:"Routing Number",labelAlign:"top"},{xtype:"numberfield",name:"accountNumber",margin:"5 5 8 8",width:250,allowBlank:false,fieldLabel:"Account Number",labelAlign:"top"}],buttons:[{text:"OK",xtype:"submitbutton",minWidth:80,itemId:"OkBtn"},{text:"Cancel",itemId:"CancelBtn"}]}];this.callParent()}});Ext.define("Bullsfirst.view.trading.OrdersView",{extend:"Ext.panel.Panel",alias:"widget.ordersview",initComponent:function initPositionsViewComponents(){var a={margin:"0 20 0 20",layout:{type:"vbox",align:"stretch"}};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function buildOrdersViewConfig(a){this.buildItems(a);this.buildToolbars(a);this.buildButtons(a)},buildItems:function buildPositionsViewItems(a){a.items=[this.buildFilterPanelConfig(),this.buildGridPanelConfig()]},buildToolbars:function buildPositionsViewToolbars(a){a.dockedItems=[{xtype:"toolbar",dock:"top",margin:"5 0 5 0",ui:"footer",padding:{left:2,bottom:1},items:[{xtype:"tbfill"},{xtype:"combo",editable:false,width:300,plugins:["loadmask"],store:"BrokerageAccountSummaries",displayField:"fullname",queryMode:"local",valueField:"id"}]}]},buildButtons:function buildPositionsViewButtons(a){a.buttons=undefined},buildFilterPanelConfig:function buildFilterPanelConfig(){var a={xtype:"form",flex:1,labelWidth:70,width:850,margin:"10 0 0 0",maxHeight:60,layout:{type:"vbox",align:"stretch"},defaults:{},items:[{xtype:"container",flex:1,maxHeight:28,collapsible:false,defaultType:"textfield",defaults:{anchor:"100%",labelWidth:40,margin:"0 0 0 20"},layout:{type:"column"},items:[{fieldLabel:"Order #",labelWidth:50,columnWidth:".16"},{fieldLabel:"Symbol",columnWidth:".16",labelWidth:45},{xtype:"datefield",fieldLabel:"From",value:new Date(),labelWidth:35,columnWidth:".17",validator:Bullsfirst.GlobalFunctions.validateFromDate},{xtype:"datefield",labelWidth:35,value:new Date(),fieldLabel:"To",columnWidth:".17",validator:Bullsfirst.GlobalFunctions.validateToDate},{xtype:"toolbar",ui:"footer",cls:"logoToolbarStyle",dock:"top",columnWidth:".34",items:[{xtype:"tbfill"},{text:"Update"},{text:"Reset Filter"}]}]},{xtype:"container",margin:"0 0 0 20",flex:1,collapsible:true,collapsed:false,checkboxToggle:true,layout:{type:"column"},items:[{xtype:"checkboxgroup",vertical:false,fieldLabel:"Order Action",columnWidth:".2",labelWidth:80,items:[{boxLabel:"Buy",name:"rb",inputValue:"1"},{boxLabel:"Sell",name:"rb",inputValue:"2"}]},{xtype:"checkboxgroup",margin:"2 0 0 20",vertical:false,labelWidth:80,columnWidth:".6",fieldLabel:"Order Status",layout:"column",items:[{boxLabel:"New",name:"rb",columnWidth:"0.12",inputValue:"1"},{boxLabel:"Partially Filled",name:"rb",columnWidth:"0.22",inputValue:"2"},{boxLabel:"Filled",name:"rb",columnWidth:"0.12",inputValue:"3"},{boxLabel:"Canceled",name:"rb",columnWidth:"0.17",inputValue:"4"},{boxLabel:"Done For Day",name:"rb",columnWidth:"0.37",inputValue:"5"}]},{xtype:"container",columnWidth:".2"}]}]};return a},buildGridPanelConfig:function buildGridPanelConfig(){var a={xtype:"treepanel",rootVisible:false,singleExpand:false,bodyStyle:{border:0},plugins:["loadmask"],remoteStore:"TradeOrderSummaries",store:"TradeOrderSummariesTree",flex:1,columns:[{header:"Creation Time",xtype:"treecolumn",sortable:false,menuDisabled:true,flex:3,dataIndex:"creationTime",renderer:function(b){return Bullsfirst.GlobalFunctions.formatDate(b)}},{header:"Order #",dataIndex:"id",sortable:false,menuDisabled:true,flex:1.2,align:"right",renderer:function(d,c,b){if(Ext.isEmpty(b.get("symbol"))){return" "}return b.get("id")}},{header:"Type",sortable:false,menuDisabled:true,flex:1.2,dataIndex:"type"},{header:"Action",sortable:false,menuDisabled:true,flex:1.2,dataIndex:"side"},{header:"Symbol",sortable:false,menuDisabled:true,flex:2,dataIndex:"symbol"},{header:"Quantity",sortable:false,menuDisabled:true,dataIndex:"quantity",flex:1.5,align:"right",renderer:Bullsfirst.extensions.Format.quantity},{header:"Limit Price",sortable:false,menuDisabled:true,flex:1.5,dataIndex:"limitPrice",align:"right",renderer:Bullsfirst.extensions.Format.usMoney},{header:"Execution Price",sortable:false,menuDisabled:true,flex:2,dataIndex:"executionPrice",align:"right",renderer:Bullsfirst.extensions.Format.usMoney},{header:"Status",sortable:false,menuDisabled:true,flex:1.5,dataIndex:"status"},{xtype:"templatecolumn",sortable:false,menuDisabled:true,flex:1,header:"Actions",align:"center",tpl:'<a href="#">{action}</a>'}]};return a}});Ext.define("Bullsfirst.model.ExternalAccount",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",persist:false},{name:"name",type:"string"},{name:"routingNumber",type:"int"},{name:"accountNumber",type:"int"},{name:"fullname",persist:false,convert:function(b,a){return a.get("name")+" - "+ +a.get("accountNumber")+"  (External)"}}],idProperty:"id",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/external_accounts"}});Ext.define("Bullsfirst.model.MarketPrice",{extend:"Ext.data.Model",fields:[{name:"symbol",type:"string"},{name:"price",convert:function(b,a){return b.amount}}],idProperty:"symbol",proxy:{type:"smartrest",appendId:true,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfexch-javaee/rest/market_prices"}});Ext.define("Bullsfirst.model.SecuritiesTransfer",{extend:"Ext.data.Model",fields:[{name:"symbol",type:"string"},{name:"quantity",type:"int"},{name:"pricePaidPerShare",convert:function(c,a){var b={amount:c,currency:"USD"};return b}},{name:"toAccountId",type:"int"}],idProperty:"toAccountId",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/accounts/{0}/transfer_securities"}});Ext.define("Bullsfirst.model.TradeOrder",{extend:"Ext.data.Model",fields:[{name:"accountName",type:"string"},{name:"symbol",type:"string"},{name:"action",type:"string"},{name:"quantity",type:"int"},{name:"orderType",type:"string"},{name:"term",type:"string"},{name:"allOrNone",type:"bool"},{name:"lastTrade",type:"float"},{name:"estimatedValue",type:"float"},{name:"fees",type:"float"},{name:"totalIncludingFees",type:"float"},{name:"marketPrice",type:"object"}]});Ext.define("Bullsfirst.model.TradeOrderEstimate",{extend:"Ext.data.Model",fields:[{name:"compliance",type:"string"},{name:"estimatedValue",convert:function(b,a){return b.amount}},{name:"fees",convert:function(b,a){return b.amount}},{name:"estimatedValueInclFees",convert:function(b,a){return b.amount}}]});Ext.define("Bullsfirst.view.trading.PreviewOrderView",{extend:"Ext.window.Window",alias:"widget.previeworderview",requires:["Ext.window.MessageBox"],title:Bullsfirst.GlobalConstants.PreviewOrder,width:600,modal:true,autoHeight:true,closable:true,resizable:false,autoShow:false,layout:{type:"fit"},initComponent:function(){this.items=[{xtype:"smartform",layout:"column",items:[{xtype:"fieldset",title:"Order Summary",margin:"10 30 10 15",columnWidth:0.55,collapsible:false,defaultType:"displayfield",defaults:{anchor:"100%",labelWidth:100},layout:"anchor",items:[{fieldLabel:"Account",name:"accountName",renderer:function(b){var a=Ext.data.StoreManager.lookup("BrokerageAccountSummaries");return a.findRecord("id",b).get("name")}},{fieldLabel:"Symbol",name:"symbol"},{fieldLabel:"Action",name:"action"},{fieldLabel:"Quantity",name:"quantity"},{fieldLabel:"OrderType",name:"orderType"},{fieldLabel:"Term",name:"term"},{fieldLabel:"All-or-none",name:"allOrNone"}]},{xtype:"fieldset",margin:"10 20 10 0",title:"Estimate",columnWidth:0.45,collapsible:false,defaultType:"displayfield",defaults:{anchor:"100%",cls:"numericFieldsCls",labelWidth:120},layout:"anchor",items:[{fieldLabel:"Last Trade",name:"lastTrade",renderer:Ext.util.Format.usMoney},{fieldLabel:"Estimated Value",name:"estimatedValue",renderer:Ext.util.Format.usMoney},{fieldLabel:"Fees",name:"fees",renderer:Ext.util.Format.usMoney},{fieldLabel:"Total Including Fees",name:"totalIncludingFees",renderer:Ext.util.Format.usMoney}]}],buttons:[{text:"Edit Order",itemId:"EditOrderBtn"},{text:"Place Order",itemId:"PlaceOrderBtn"}]}];this.callParent()}});Ext.define("Bullsfirst.model.CashTransfer",{extend:"Ext.data.Model",fields:[{name:"amount",convert:function(c,a){var b={amount:c,currency:"USD"};return b}},{name:"toAccountId",type:"int"}],idProperty:"toAccountId",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/accounts/{0}/transfer_cash"}});Ext.define("Bullsfirst.store.AllAccounts",{extend:"Ext.data.Store",fields:[]});Ext.define("Bullsfirst.model.TradeOrderEstimateRequest",{extend:"Ext.data.Model",fields:[{name:"brokerageAccountId",type:"int"},{name:"orderParams",convert:function(b,a){if(Ext.isObject(b)){return{side:b.get("action"),symbol:b.get("symbol"),quantity:b.get("quantity"),type:b.get("orderType"),limitPrice:{amount:b.get("totalIncludingFees"),currency:"USD"},term:b.get("term"),allOrNone:b.get("allOrNone")}}}}],idProperty:"brokerageAccountId",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/order_estimates"}});Ext.define("Bullsfirst.store.LoggedInUser",{extend:"Ext.data.Store",model:"Bullsfirst.model.User"});Ext.define("Bullsfirst.view.accounts.LoginView",{extend:"Bullsfirst.extensions.SmartFormPanel",alias:"widget.loginview",initComponent:function(){var a={layout:"anchor",maxHeight:140,defaultType:"textfield",defaults:{enableKeyEvents:true,margin:"5 2 2 12",width:170}};this.buildConfig(a);Ext.apply(this,Ext.apply(this.initialConfig,a));this.callParent()},buildConfig:function(a){this.buildItems(a);this.buildButtons(a)},buildItems:function(a){a.items=[{xtype:"textfield",name:"username",allowBlank:false,fieldLabel:"Username",blankText:"Please enter your username",labelAlign:"top"},{xtype:"textfield",name:"password",allowBlank:false,blankText:"Please enter your password",fieldLabel:"Password",labelAlign:"top",inputType:"password"}]},buildButtons:function(a){this.buildFormPanelToolBars(a)},buildFormPanelToolBars:function(a){a.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",margin:"0 0 0 5",defaults:{minWidth:50,maxWidth:100},items:[{xtype:"component",itemId:"openAccountLink",autoEl:{tag:"a",href:"#",html:Bullsfirst.GlobalConstants.OpenAccount},flex:1}]},{xtype:"toolbar",dock:"bottom",ui:"footer",margin:"0 0 0 5",defaults:{minWidth:50,maxWidth:60},items:[{xtype:"submitbutton",text:Bullsfirst.GlobalConstants.Login,flex:1}]}]}});Ext.define("Bullsfirst.store.MarketPrices",{extend:"Ext.data.Store",model:"Bullsfirst.model.MarketPrice"});Ext.define("Bullsfirst.store.TradeOrderSummariesTree",{extend:"Ext.data.TreeStore",model:"Bullsfirst.model.TradeOrderSummary",autoLoad:false,data:null,root:{expanded:true,loaded:false},proxy:{type:"memory",reader:{type:"json",root:"executions"}},listeners:{beforeload:function(a,b){return this.autoLoad}}});Ext.define("Bullsfirst.controller.trading.MainController",{extend:"Ext.app.Controller",views:["trading.AccountsView","trading.CreateBrokerageAccountView","trading.OrdersView","trading.PositionsView","trading.TradeView","trading.TradingTabPanel","trading.TransactionsView","trading.TransferView","shared.MainContentPanel"],models:["User","Position","BrokerageAccountSummary","BrokerageAccount","TradeAction","TradeOrderType","TradeTerm","Instrument","TradeOrderSummary"],stores:["Positions","BrokerageAccountSummaries","BrokerageAccounts","TradeActions","TradeOrderTypes","TradeTerms","Instruments","TradeOrderSummaries","PositionsTree"],refs:[{ref:"TradingTabPanel",selector:"tradingtabpanel"},{ref:"PositionsTab",selector:"tradingtabpanel component[title=Positions]"},{ref:"LoggedInUserNameField",selector:"tradingtabpanel label[itemId=userName]"},{ref:"PositionsViewCombo",selector:"positionsview combo"},{ref:"TradeViewCombo",selector:"tradeview combo[fieldLabel=Account]"},{ref:"OrdersViewCombo",selector:"ordersview combo"},{ref:"TransactionsViewCombo",selector:"transactionsview combo"}],init:function(){this.control({tradingtabpanel:{beforerender:this.onTradingTabPanelBeforeRender},"tradingtabpanel tabbar":{change:this.onTabPanelTabChange},"tradingtabpanel component[itemId=signOutLink]":{render:this.onSignOutLinkRender}});this.callParent()},onTradingTabPanelBeforeRender:function onTradingTabPanelBeforeRender(a){var b=this.getPositionsViewCombo();a.selectedBrokerageAccount=new Bullsfirst.extensions.SelectedBrokerageAccount();a.selectedBrokerageAccount.addListener("change",this.onSelectedBrokerageAccountChange,this);this.getLoggedInUserNameField().setText(a.loggedInUser.firstName+" "+a.loggedInUser.lastName);EventAggregator.subscribe("brokerageaccountsstoreloaded",function(d){if(d.count()>0){var c=d.first().get("id");a.selectedBrokerageAccount.setValue(c);b.on("render",function(){if(!b.getValue()){b.setValue(c)}})}},this);this.getStore("BrokerageAccountSummaries").load();this.getStore("Instruments").load()},onSignOutLinkRender:function onSignOutLinkRender(a){a.getEl().on("click",this.onSignOutLinkClick,this)},onSignOutLinkClick:function onSignOutLinkClick(a){this.getController("login.LoginController").injectView(Ext.create("widget.mainContentPanel"))},onSelectedBrokerageAccountChange:function onSelectedBrokerageAccountChange(a){this.getTradeViewCombo().setValue(a);this.getOrdersViewCombo().setValue(a);this.getTransactionsViewCombo().setValue(a)},onTabPanelTabChange:function onTabPanelTabChange(a,b){if(b!=null){b.fireEvent("activate",b)}}});Ext.define("Bullsfirst.controller.trading.AccountsController",{extend:"Ext.app.Controller",views:["trading.AccountsView","accounts.CreateAccountView","trading.CreateBrokerageAccountView","trading.EditBrokerageAccountView","trading.TradingTabPanel"],models:["BrokerageAccount","EditBrokerageAccount","BrokerageAccountSummary"],stores:["BrokerageAccounts","BrokerageAccountSummaries"],refs:[{ref:"TradingTabPanel",selector:"tradingtabpanel"},{ref:"PositionsViewCombo",selector:"positionsview combo"},{ref:"PositionsTab",selector:"tradingtabpanel component[title=Positions]"},{ref:"CreateAccountOkButton",selector:"createBrokerageAccountView button[itemId=OkBtn]"},{ref:"CreateBrokerageAccountTextField",selector:"createBrokerageAccountView textfield"},{ref:"AccountsViewGrid",selector:"accountsview grid"}],init:function(){this.control({"accountsview button[itemId=AddAccountBtn]":{click:this.onAddAccountButtonClick},"accountsview button[itemId=UpdateAccountBtn]":{click:this.onUpdateAccountButtonClick},"createBrokerageAccountView button[itemId=OkBtn]":{click:this.onCreateAccountOkButtonClick},"createBrokerageAccountView button[itemId=CancelBtn]":{click:this.onCreateAccountCancelButtonClick},"editbrokerageaccountview button[itemId=OkBtn]":{click:this.onEditAccountOkButtonClick},"editbrokerageaccountview button[itemId=CancelBtn]":{click:this.onEditAccountCancelButtonClick},"accountsview templatecolumn[text=Name]":{click:this.onAccountsBrokerageNameClick},"accountsview templatecolumn[text=Actions]":{click:this.onEditAccountLinkClick}});this.callParent()},onEditAccountLinkClick:function onEditAccountLinkClick(c,e,a){var f=Ext.create("widget.editbrokerageaccountview");var b=this.getStore("BrokerageAccountSummaries");var d=f.down("form");d.getForm().loadRecord(b.getAt(a));f.show()},onAddAccountButtonClick:function onAddAccountButtonClick(a){Ext.create("widget.createBrokerageAccountView").show()},onUpdateAccountButtonClick:function onUpdateAccountButtonClick(a){this.getStore("BrokerageAccountSummaries").load()},onCreateAccountOkButtonClick:function onCreateAccountOkButtonClick(b){b.disable();var a=this.getStore("BrokerageAccountSummaries");EventAggregator.subscribe("brokerageaccountcreated",function(){a.load();b.up("window").close()},this);this.createBrokerageAccount(this.getCreateBrokerageAccountTextField().getValue())},onCreateAccountCancelButtonClick:function onCreateAccountCancelButtonClick(a){a.up("window").close()},onEditAccountOkButtonClick:function onEditAccountOkButtonClick(c){c.disable();var f=c.up("form");var a=this.getStore("BrokerageAccountSummaries");var b=Ext.create("Bullsfirst.model.EditBrokerageAccount");var d=b.getProxy();var e=d.url;d.url=Ext.String.format(d.url,f.getForm().getRecord().get("id"));f.getForm().updateRecord(b);EventAggregator.subscribe("brokerageaccountedited",function(){a.load();c.up("window").close()},this);this.editBrokerageAccount(b);d.url=e},onEditAccountCancelButtonClick:function onEditAccountCancelButtonClick(a){a.up("window").close()},onAccountsBrokerageNameClick:function onAccountsBrokerageNameClick(a,b,d){var c=this.getTradingTabPanel();this.getPositionsViewCombo().setValue(this.getStore("BrokerageAccountSummaries").getAt(d));c.setActiveTab(this.getPositionsTab())},createBrokerageAccount:function(b){var a=Ext.create("Bullsfirst.model.BrokerageAccount",{accountName:b},this);a.phantom=true;a.save({action:"create",scope:this,callback:function(c,d,e){if(d.wasSuccessful()==true){EventAggregator.publish("brokerageaccountcreated",d)}else{EventAggregator.publish("brokerageaccountcreationError",d)}}},this)},editBrokerageAccount:function(a){a.phantom=true;a.save({action:"create",scope:this,callback:function(b,c,d){if(c.wasSuccessful()==true){EventAggregator.publish("brokerageaccountedited")}else{EventAggregator.publish("brokerageaccounteditError",c)}}},this)}});Ext.define("Bullsfirst.controller.trading.PositionsController",{extend:"Ext.app.Controller",views:["trading.PositionsView","trading.TradingTabPanel"],models:["BrokerageAccountSummary","Position"],stores:["BrokerageAccountSummaries","Positions","PositionsTree","TradeActions"],refs:[{ref:"TradingTabPanel",selector:"tradingtabpanel"},{ref:"TradeTab",selector:"tradingtabpanel component[title=Trade]"},{ref:"PositionsViewCombo",selector:"positionsview combo"},{ref:"PositionsViewGrid",selector:"positionsview grid"}],init:function(){this.control({"positionsview combo":{change:this.onPositionViewComboChange},"positionsview templatecolumn":{click:this.onActionColumnClick}});this.callParent()},onPositionViewComboChange:function onPositionViewComboChange(e,c,a){var b=this.getTradingTabPanel();var d=this.getStore("PositionsTree");if(c!=a){b.selectedBrokerageAccount.setValue(this.getStore("BrokerageAccountSummaries").findRecord("id",c));this.reloadPositions()}},onActionColumnClick:function onActionColumnClick(j,g,e,b,a,f){var d="Buy";var n=this.getPositionsViewCombo();if(b==10){d="Sell"}var l=this.getStore("PositionsTree");var k=this.getTradingTabPanel();var m=this.getTradeTab();var i=m.down("form").getForm();var h=Ext.create("Bullsfirst.model.TradeOrder",{symbol:f.get("instrumentSymbol"),action:d,quantity:f.get("quantity"),orderType:"Market",term:"GoodForTheDay",allOrNone:false});i.loadRecord(h);var c=n.getValue();m.down("combo").setValue(c);k.setActiveTab(m)},reloadPositions:function reloadPositions(){var d=this.getTradingTabPanel();var e=this.getStore("PositionsTree");var b=d.selectedBrokerageAccount.getValue().positions().getRange();var a=new Array();for(var c=0;c<b.length;c++){a.push(Ext.clone(b[c].data))}e.proxy.data={children:a};e.load()}});Ext.define("Bullsfirst.controller.trading.TransactionsController",{extend:"Ext.app.Controller",views:["trading.TradingTabPanel","trading.TransactionsView"],models:["Transaction"],stores:["Transactions"],refs:[{ref:"TransactionsViewGrid",selector:"transactionsview grid"},{ref:"TransactionsViewCombo",selector:"transactionsview combo"},{ref:"TransactionsViewFromDateFilter",selector:"transactionsview datefield[fieldLabel=From]"},{ref:"TransactionsViewToDateFilter",selector:"transactionsview datefield[fieldLabel=To]"}],init:function(){this.control({"transactionsview combo":{change:this.onTransactionsViewComboChange},transactionsview:{afterrender:this.onTransactionsViewAfterRender},"transactionsview button[text=Update]":{click:this.onUpdateBtnClick},"transactionsview button[text=Reset Filter]":{click:this.onResetFilterBtnClick}});this.callParent()},onTransactionsViewComboChange:function onTransactionsViewComboChange(c,b,a){if(b!=a&&a!=null&&a!=undefined){this.processFilters()}},onTransactionsViewAfterRender:function onTransactionsViewAfterRender(a){this.processFilters()},onUpdateBtnClick:function onUpdateBtnClick(a){this.processFilters()},onResetFilterBtnClick:function onResetFilterBtnClick(a){this.getTransactionsViewFromDateFilter().setValue(new Date());this.getTransactionsViewToDateFilter().setValue(new Date());this.processFilters()},loadTransactionsStore:function loadTransactionsStore(c){var a=this.getStore("Transactions");var b=Bullsfirst.model.Transaction.proxy;b.queryParams=c;a.load()},processFilters:function processFilters(){var c=this.getTransactionsViewFromDateFilter().getValue();var b=this.getTransactionsViewToDateFilter().getValue();var a={accountId:this.getTransactionsViewCombo().getValue(),fromDate:c==null?"":Ext.Date.format(c,"Y-m-d"),toDate:b==null?"":Ext.Date.format(b,"Y-m-d")};this.loadTransactionsStore(a)}});Ext.define("Bullsfirst.controller.login.LoginController",{extend:"Ext.app.Controller",views:["shared.MainContentPanel","accounts.LoginView","accounts.CreateAccountView","trading.TradingTabPanel"],models:["User"],stores:["LoggedInUser"],refs:[{ref:"MainContentPanel",selector:"viewport panel[itemId=mainContentRegion]"},{ref:"CreateAccountWindow",selector:"createaccountview"},{ref:"CreateAccountWindowUserName",selector:"createaccountview textfield[name=username]"},{ref:"LoginUserNameField",selector:"loginview textfield[name=username]"},{ref:"LoginPasswordField",selector:"loginview textfield[name=password]"},{ref:"LoginButton",selector:"loginview button"}],init:function(){this.control({"loginview component[itemId=openAccountLink]":{render:this.onOpenAccountLinkRender},"loginview button":{click:this.onLoginButtonClick},"createaccountview button[action=openAccount]":{click:this.onOpenAccountButtonClick},"createaccountview button[action=cancel]":{click:this.onCancelButtonClick}});this.callParent()},onOpenAccountLinkRender:function onOpenAccountLinkRender(a){a.getEl().on("click",this.onOpenAccountLinkClick,this)},onOpenAccountLinkClick:function onOpenAccountLinkClick(a){Ext.create("widget.createaccountview").show()},onLoginButtonClick:function onLoginButtonClick(b){var e=b.up("form").getForm();if(e.hasInvalidField()){Ext.Msg.alert(Bullsfirst.GlobalConstants.ErrorTitle,Bullsfirst.GlobalConstants.InvalidForm);submitButton.disable()}var d=this.getLoginUserNameField().getValue();var a=this.getLoginPasswordField().getValue();this.updateUserStore(d,a);var c=new Ext.LoadMask(b.up("viewport"),{msg:Bullsfirst.GlobalConstants.LoggingInMaskMessage});e.mask=c;c.show();e.submit({method:"GET",scope:this,headers:{password:a},clientValidation:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/users/"+d,success:this.processLoggedInUser,failure:this.processLoggedInUser},this)},onOpenAccountButtonClick:function onOpenAccountButtonClick(c){var b=c.up("form").getForm();if(b.hasInvalidField()){Ext.Msg.alert(Bullsfirst.GlobalConstants.ErrorTitle,Bullsfirst.GlobalConstants.InvalidForm)}c.disable();var a=Ext.create("Bullsfirst.model.User");b.updateRecord(a);this.updateUserStore(a.get("username"),a.get("password"));EventAggregator.subscribe("useraccountcreated",this.onUserAccountCreated,this);a.save({callback:function(d,e,f){if(e.wasSuccessful()==true){EventAggregator.publish("useraccountcreated",e)}else{EventAggregator.publish("useraccountcreationError",e);c.enable()}}},this)},onUserAccountCreated:function onUserAccountCreated(){EventAggregator.subscribe("brokerageaccountcreated",this.onBrokerageAccountCreated,this);var a=this.getController("Bullsfirst.controller.trading.AccountsController");a.createBrokerageAccount(Bullsfirst.GlobalConstants.BrokeageAccountDefaultName)},onBrokerageAccountCreated:function(b){var c=JSON.parse(b.response.responseText).id;EventAggregator.subscribe("externalaccountcreated",function(e){this.onExternalAccountCreated(e,c)},this);var a=Ext.create("Bullsfirst.model.ExternalAccount",{name:Bullsfirst.GlobalConstants.ExternalAccountDefaultName,routingNumber:Bullsfirst.GlobalConstants.ExternalAccountDefaultRoutingNumber,accountNumber:Bullsfirst.GlobalConstants.ExternalAccountDefaultAccountNumber});var d=this.getController("Bullsfirst.controller.trading.TransferController");d.createNewExternalAccount(a)},onExternalAccountCreated:function(b,e){var c=JSON.parse(b.response.responseText).id;var d=Ext.create("Bullsfirst.model.CashTransfer",{amount:Bullsfirst.GlobalConstants.DefaultTransferAmount,toAccountId:e});var a=c;var f=this.getController("Bullsfirst.controller.trading.TransferController");EventAggregator.subscribe("transferprocessed",this.onTransferProcessed,this);f.processTransferRequest(d,a)},onTransferProcessed:function(){Ext.Msg.alert(Bullsfirst.GlobalConstants.AccountCreated,Bullsfirst.GlobalConstants.AccountReloginMsg);this.getLoginUserNameField().setValue(this.getCreateAccountWindowUserName().getValue());this.getCreateAccountWindow().close()},onCancelButtonClick:function onCancelButtonClick(a){a.up("window").close()},processLoggedInUser:function processLoggedInUser(b,c){var a=this;b.mask.hide();EventAggregator.subscribe("userloggedin",function(d){a.injectView(Ext.create("widget.tradingtabpanel",{loggedInUser:d.result}))},this);if(c.response.status==200){EventAggregator.publish("userloggedin",c)}else{EventAggregator.publish("userloginError",c)}},updateUserStore:function updateUserStore(d,b){var a=Ext.create("Bullsfirst.model.User",{username:d,password:b});var c=this.getStore("LoggedInUser");c.removeAll();c.add(a)},injectView:function injectView(b){var a=this.getMainContentPanel();var c=a.up("container");c.remove(a);b.flex=1;b.itemId="mainContentRegion";c.add(b)}});Ext.define("Bullsfirst.controller.trading.OrdersController",{extend:"Ext.app.Controller",views:["trading.OrdersView","trading.TradingTabPanel"],models:["TradeOrderSummary"],stores:["TradeOrderSummaries","TradeOrderSummariesTree"],refs:[{ref:"OrderViewCombo",selector:"ordersview combo"},{ref:"OrderViewSymbolFilter",selector:"ordersview textfield[fieldLabel=Symbol]"},{ref:"OrderViewOrderIdFilter",selector:"ordersview textfield[fieldLabel=Order #]"},{ref:"OrderViewFromDateFilter",selector:"ordersview datefield[fieldLabel=From]"},{ref:"OrderViewToDateFilter",selector:"ordersview datefield[fieldLabel=To]"},{ref:"OrderViewSidesFilter",selector:"ordersview checkboxgroup[fieldLabel=Order Action]"},{ref:"OrderViewStatusesFilter",selector:"ordersview checkboxgroup[fieldLabel=Order Status]"}],init:function(){this.control({"ordersview combo":{change:this.onOrdersViewComboChange},ordersview:{afterrender:this.onOrdersViewAfterRender},"ordersview templatecolumn[text=Actions]":{click:this.onCancelOrderLinkClick},"ordersview button[text=Update]":{click:this.onUpdateBtnClick},"ordersview button[text=Reset Filter]":{click:this.onResetFilterBtnClick}});this.callParent()},onOrdersViewComboChange:function onOrdersViewBeforeRender(b,c,a){if(c!=a&&a!=null&&a!=undefined){this.processFilters()}},onOrdersViewAfterRender:function onOrdersViewAfterRender(a){this.processFilters()},onCancelOrderLinkClick:function onCancelOrderLinkClick(c,f,a){var d=this.getStore("TradeOrderSummaries");var e=d.getAt(a).get("id");var b=Ext.create("Ext.form.Panel",{title:"cancel Form",scope:this,afterAction:this.processCancelOrderResponse},this);var g=Ext.create("Bullsfirst.extensions.SubmitActionWithNoResponse",{form:b.getForm(),headers:{Authorization:Bullsfirst.GlobalFunctions.getAuthenticationHeader()},clientValidation:false,timeout:30,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/orders/"+e+"/cancel"},this);b.getForm().doAction(g)},onUpdateBtnClick:function onUpdateBtnClick(a){this.processFilters()},onResetFilterBtnClick:function onResetFilterBtnClick(a){this.getOrderViewSymbolFilter().setValue("");this.getOrderViewOrderIdFilter().setValue("");this.getOrderViewFromDateFilter().setValue(new Date());this.getOrderViewToDateFilter().setValue(new Date());this.clearChecks(this.getOrderViewSidesFilter());this.clearChecks(this.getOrderViewStatusesFilter());this.processFilters()},processCancelOrderResponse:function processCancelOrderResponse(a,b){if(b){this.scope.processFilters();EventAggregator.publish("ordercanceled")}else{EventAggregator.publish("ordercancellationError")}},clearChecks:function clearChecks(a){a.items.each(function(b){b.setValue(false)})},getFilteredChecks:function getFilteredChecks(b){var a="";b.items.each(function(c){if(c.getValue()==true){if(a!=""){a+=","}a+=c.boxLabel.split(" ").join("")}});return a},processFilters:function processFilters(){var e=this.getOrderViewFromDateFilter().getValue();var b=this.getOrderViewToDateFilter().getValue();var d=this.getFilteredChecks(this.getOrderViewSidesFilter());var c=this.getFilteredChecks(this.getOrderViewStatusesFilter());var a={accountId:this.getOrderViewCombo().getValue(),symbol:this.getOrderViewSymbolFilter().getValue(),orderId:this.getOrderViewOrderIdFilter().getValue(),fromDate:e==null?"":Ext.Date.format(e,"Y-m-d"),toDate:b==null?"":Ext.Date.format(b,"Y-m-d"),sides:d,statuses:c};this.loadOrdersStore(a)},loadOrdersStore:function loadOrdersStore(d){var a=this.getStore("TradeOrderSummaries");var c=this.getStore("TradeOrderSummariesTree");var b=a.proxy;b.queryParams=d;EventAggregator.subscribe("ordersstoreloaded",function(e){if(e.count()>0){c.autoLoad=true;var k=e.getRange();var l=new Array();for(var h=0;h<k.length;h++){var g=k[h].get("executions");if(g&&g.length>0){for(var f=0;f<g.length;f++){g[f].id=k[h].get("id")+"/"+g[f].id}}l.push(k[h].data)}c.proxy.data={executions:l}}else{c.proxy.data=null}c.load()});a.load()}});Ext.define("Bullsfirst.store.ExternalAccounts",{extend:"Bullsfirst.store.AbstractStore",model:"Bullsfirst.model.ExternalAccount",alias:"externalaccountsstore"});Ext.define("Bullsfirst.controller.trading.TransferController",{extend:"Ext.app.Controller",views:["trading.TradingTabPanel","trading.TransferView","trading.CreateExternalAccountView"],models:["CashTransfer","ExternalAccount","SecuritiesTransfer","MarketPrice"],stores:["ExternalAccounts","BrokerageAccountSummaries","AllAccounts","Instruments"],refs:[{ref:"TradingTabPanel",selector:"tradingtabpanel"},{ref:"PositionsTab",selector:"tradingtabpanel component[title=Positions]"},{ref:"LastTradeField",selector:"transferview displayfield[name=lastTrade]"},{ref:"TransferForm",selector:"transferview form"},{ref:"TransferFormSymbolContainer",selector:"transferview container[transferType=Securities]",},{ref:"TransferFromAccountField",selector:"transferview combo[fieldLabel=From]"},{ref:"TransferToAccountField",selector:"transferview combo[fieldLabel=To]"},{ref:"TransferSymbolField",selector:"transferview combo[fieldLabel=Symbol]"},{ref:"CreateExternalAccountWindow",selector:"createexternalaccountview"},{ref:"PositionsViewCombo",selector:"positionsview combo"}],init:function(){this.control({"tradingtabpanel component[title=Transfer]":{activate:this.onTransferViewActivate},"transferview combo[fieldLabel=Symbol]":{change:this.onTransferSymbolComboChange,blur:this.onTransferSymbolComboBlur},"transferview component[itemId=createExternalAccountLink]":{render:this.oncreateExternalAccountLinkRender},"transferview radiofield":{change:this.onRadioFieldChange},"createexternalaccountview button[itemId=OkBtn]":{click:this.onOkBtnClick},"createexternalaccountview button[itemId=CancelBtn]":{click:this.onCancelBtnClick},"transferview button":{click:this.onTransferBtnClick}});this.callParent()},onTransferViewActivate:function onTransferViewActivate(){this.loadAllStores()},oncreateExternalAccountLinkRender:function oncreateExternalAccountLinkRender(a){a.getEl().on("click",this.oncreateExternalAccountLinkClick,this)},oncreateExternalAccountLinkClick:function oncreateExternalAccountLinkClick(b){var a=Ext.create("widget.createexternalaccountview");a.show()},onOkBtnClick:function onOkBtnClick(b){b.disable();var c=b.up("form");var a=Ext.create("Bullsfirst.model.ExternalAccount");c.getForm().updateRecord(a);EventAggregator.subscribe("externalaccountcreated",function(){this.loadAllStores();b.up("window").close()},this);this.createNewExternalAccount(a)},onCancelBtnClick:function onCancelBtnClick(a){a.up("window").close()},onRadioFieldChange:function onRadioFieldChange(c,e,b){if(e!=b&&e==true){var d=this.getTransferFormSymbolContainer();d.setVisible(d.transferType==c.boxLabel);var a=this.getTransferForm().getForm().getFields();a.each(function(f){if(!Ext.isEmpty(f.transferType)&&f.transferType!=c.boxLabel){f.setVisible(false)}else{f.setVisible(true)}},this)}},onTransferSymbolComboBlur:function(d){var b=this.getStore("Instruments");var a=d.getRawValue();if(b.findExact("symbol",a)<0){var c=b.findExact("symbolFullName",a);if(c>=0){d.setValue(b.getAt(c))}}},onTransferSymbolComboChange:function onTransferSymbolComboChange(e,d,c){if(this.getStore("Instruments").findExact("symbol",d)>=0){e.setRawValue(d)}else{return}if(d!=c){var b=this.getModel("MarketPrice");var a=this.getTransferForm();EventAggregator.subscribe("marketpricerecieved",function(f){var g=this.getLastTradeField();var h=f.resultSet.records[0];g.setVisible(true);g.setValue(h.get("price"))},this);b.load(e.getValue(),{scope:this,callback:function(f,g){if(g.wasSuccessful()==true){EventAggregator.publish("marketpricerecieved",g)}else{EventAggregator.publish("marketpricerecieveError",g)}}},this)}},onTransferBtnClick:function onTransferBtnClick(c){var b=c.up("form");if(b.getForm().hasInvalidField()){Ext.Msg.alert(Bullsfirst.GlobalConstants.ErrorTitle,Bullsfirst.GlobalConstants.InvalidForm)}c.disable();var e=this.getTransferSymbolField().hidden?Ext.create("Bullsfirst.model.CashTransfer"):Ext.create("Bullsfirst.model.SecuritiesTransfer");var a=this.getTransferFromAccountField().getValue();var d=this.getTransferToAccountField().getValue();b.getForm().updateRecord(e);this.processTransferRequest(e,a,c)},processTransferRequest:function processTransferRequest(d,a,c){var b=d.getProxy();var f=b.url;b.url=Ext.String.format(b.url,a);EventAggregator.subscribe("transferprocessed",this.onTransferProcessed,this);var e=d.get("toAccountId");d.phantom=true;d.save({action:"create",scope:this,callback:function(g,i,j){if(i.wasSuccessful()==true){var h={fromAccount:a,toAccount:e};EventAggregator.publish("transferprocessed",i,h)}else{EventAggregator.publish("transferprocessError",i)}if(c){c.enable()}}},this);b.url=f},onTransferProcessed:function(b,d,e){var c=this.getTradingTabPanel();var a=this.getStore("BrokerageAccountSummaries");EventAggregator.subscribe("brokerageaccountsstoreloaded",function(){var f=a.getById(e.toAccount);if(f==null){f=a.getById(e.fromAccount)}if(c!=null){c.setActiveTab(this.getPositionsTab());this.getPositionsViewCombo().setValue(f);this.getController("Bullsfirst.controller.trading.PositionsController").reloadPositions()}},this);this.loadAllStores()},loadAllStores:function loadAllStores(){var a=this.getStore("BrokerageAccountSummaries");var d=this.getStore("ExternalAccounts");var c=this.getStore("Instruments");var b=this.getStore("AllAccounts");b.removeAll();a.load();EventAggregator.subscribe("externalaccountsstoreloaded",function(){b.loadData(a.getRange());b.loadData(d.getRange(),true)},this);d.load();c.clearFilter();if(c.count()==0){c.load()}},createNewExternalAccount:function(a){a.phantom=true;a.save({action:"create",scope:this,callback:function(b,c,d){if(c.wasSuccessful()==true){EventAggregator.publish("externalaccountcreated",c)}else{EventAggregator.publish("externalaccountcreationError",c)}}},this)}});Ext.define("Bullsfirst.model.TradeOrderRequest",{extend:"Bullsfirst.model.TradeOrderEstimateRequest",proxy:{type:"smartrest",appendId:false,url:Bullsfirst.GlobalConstants.BaseUrl+"/bfoms-javaee/rest/secure/orders"}});Ext.define("Bullsfirst.controller.trading.TradeController",{extend:"Ext.app.Controller",views:["trading.TradeView","trading.TradingTabPanel","trading.PreviewOrderView"],models:["TradeAction","TradeOrderType","TradeTerm","TradeOrder","Instrument","MarketPrice","TradeOrderEstimateRequest","TradeOrderEstimate","TradeOrderRequest"],stores:["TradeActions","TradeOrderTypes","TradeTerms","Instruments","MarketPrices"],refs:[{ref:"TradeViewCombo",selector:"tradeview combo"},{ref:"TradeForm",selector:"tradeview form"},{ref:"LastTradeField",selector:"tradeview displayfield[fieldLabel=Last Trade]"},{ref:"PreviewOrderWindow",selector:"previeworderview"},{ref:"PreviewOrderForm",selector:"previeworderview form"},{ref:"TradingTabPanel",selector:"tradingtabpanel"},{ref:"OrdersTab",selector:"tradingtabpanel component[title=Orders]"},{ref:"PositionsViewCombo",selector:"positionsview combo"}],init:function(){this.control({"tradeview combo[fieldLabel=Symbol]":{change:this.onTradeSymbolComboChange,blur:this.onTradeSymbolComboBlur},"tradingtabpanel component[title=Trade]":{activate:this.onTradeViewActivate},"tradeview combo[fieldLabel=Action]":{beforerender:this.onTradeActionComboBeforeRender},"tradeview combo[fieldLabel=Order Type]":{beforerender:this.onTradeOrderTypeComboBeforeRender},"tradeview combo[fieldLabel=Term]":{beforerender:this.onTradeTermComboBeforeRender},"tradeview button":{click:this.onTradePreviewOrderBtnClick},"previeworderview button[itemId=EditOrderBtn]":{click:this.onPreviewOrderEditOrderBtnClick},"previeworderview button[itemId=PlaceOrderBtn]":{click:this.onPreviewOrderPlaceOrderBtnClick}});this.callParent()},onTradeViewActivate:function onTradeViewActivate(){var a=this.getStore("Instruments");a.clearFilter();if(a.count()==0){a.load()}},onTradeActionComboBeforeRender:function onTradeActionComboBeforeRender(a){a.setValue(this.getStore("TradeActions").first())},onTradeOrderTypeComboBeforeRender:function onTradeOrderTypeComboBeforeRender(a){a.setValue(this.getStore("TradeOrderTypes").first())},onTradeTermComboBeforeRender:function onTradeTermComboBeforeRender(a){a.setValue(this.getStore("TradeTerms").first())},onTradePreviewOrderBtnClick:function onTradePreviewOrderButtonClick(e){var c=e.up("form");if(c.getForm().hasInvalidField()){Ext.Msg.alert(Bullsfirst.GlobalConstants.ErrorTitle,Bullsfirst.GlobalConstants.InvalidForm);e.disable()}var b=Ext.create("Bullsfirst.model.TradeOrder");var f=this.getTradeViewCombo().getValue();var d=this.getLastTradeField().getValue();c.getForm().updateRecord(b);var a=Ext.create("Bullsfirst.model.TradeOrderEstimateRequest",{brokerageAccountId:f,orderParams:b});EventAggregator.subscribe("orderestimatecreated",function(g){var i=Ext.ModelManager.create(JSON.parse(g.response.responseText),"Bullsfirst.model.TradeOrderEstimate");if(i.get("compliance")=="Compliant"){c.getForm().updateRecord(b);var h=this.getLastTradeField().getValue();if(Ext.isEmpty(h)){return}b.set("lastTrade",h);b.set("estimatedValue",i.get("estimatedValue"));b.set("fees",i.get("fees"));b.set("totalIncludingFees",i.get("estimatedValueInclFees"));var j=Ext.create("widget.previeworderview");j.down("form").getForm().loadRecord(b);j.show()}else{g.customError="Order is not compliant:"+i.get("compliance");EventAggregator.publish("tradeordercomplianceError",g);e.enable()}},this);a.phantom=true;a.save({action:"create",scope:this,callback:function(g,h,i){if(h.wasSuccessful()==true){EventAggregator.publish("orderestimatecreated",h)}else{EventAggregator.publish("orderestimatecreationError",h)}}},this)},onPreviewOrderEditOrderBtnClick:function onPreviewOrderEditOrderBtnClick(a){a.up("window").close()},onPreviewOrderPlaceOrderBtnClick:function onPreviewOrderPlaceOrderBtnClick(c){c.disable();var d=c.up("form");var a=d.getForm().getRecord();var f=this.getTradeViewCombo().getValue();var b=this.getTradingTabPanel();var e=Ext.create("Bullsfirst.model.TradeOrderRequest",{brokerageAccountId:f,orderParams:a});EventAggregator.subscribe("ordercreated",function(h){c.up("window").close();var g=this.getStore("BrokerageAccountSummaries");var i=g.getById(f);this.getPositionsViewCombo().setValue(i);this.getController("Bullsfirst.controller.trading.OrdersController").processFilters();b.setActiveTab(this.getOrdersTab())},this);e.phantom=true;e.save({action:"create",scope:this,callback:function(g,h,i){if(h.wasSuccessful()==true){EventAggregator.publish("ordercreated",h)}else{EventAggregator.publish("ordercreationError",h);c.enable()}}},this)},onTradeSymbolComboBlur:function(a){var c=this.getStore("Instruments");var b=a.getRawValue();if(c.findExact("symbol",b)<0){var d=c.findExact("symbolFullName",b);if(d>=0){a.setValue(c.getAt(d))}}},onTradeSymbolComboChange:function onTradeSymbolComboChange(a,e,d){if(this.getStore("Instruments").findExact("symbol",e)>=0){a.setRawValue(e)}else{return}if(e!=d){var b=this.getModel("MarketPrice");var c=this.getTradeForm();EventAggregator.subscribe("marketpricerecieved",function(f){var g=this.getLastTradeField();var h=f.resultSet.records[0];g.setVisible(true);g.setValue(h.get("price"))},this);b.load(a.getValue(),{scope:this,callback:function(f,g){if(g.wasSuccessful()==true){EventAggregator.publish("marketpricerecieved",g)}else{EventAggregator.publish("marketpricerecieveError",g)}}},this)}}});Ext.define("EventAggregator",{singleton:true,mixins:{observable:"Ext.util.Observable"},events:["userloggedin","userloginError","useraccountcreated","useraccountcreationError","brokerageaccountcreated","brokerageaccountcreationError","externalaccountcreated","externalaccountcreationError","brokerageaccountedited","brokerageaccounteditError","brokerageaccountsstoreloaded","brokerageaccountsstoreloadError","instrumentsstoreloaded","instrumentsstoreloadError","ordercanceled","ordercancellationError","orderestimatecreated","orderestimatecreationError","ordercreated","ordercreationError","marketpricerecieved","marketpricerecieveError","transactionsstoreloaded","transactionsstoreloadError","externalaccountsstoreloaded","externalaccountsstoreloadError","transferprocessed","transferprocessError","tradeordercomplianceError","ordersstoreloaded","ordersstoreloadError"],hasListeners:{},publish:function publish(b,a,c){EventAggregator.fireEvent(b,a,b,c)},subscribeForever:function subscribeForever(a,b,c){EventAggregator.addListener(a,b,c)},subscribe:function subscribe(a,b,c){EventAggregator.addListener(a,b,c,{single:true})},unsubscribe:function unsubscribe(a,b,c){EventAggregator.removeListener(a,b,c)}});Ext.define("Bullsfirst.extensions.Format",{singleton:true,usMoney:function(b){var a=Ext.util.Format.usMoney(b);if(a=="$"||a=="$0.00"){return" "}return a},quantity:function(a){if(a==0){return" "}return a}});Ext.define("Bullsfirst.extensions.SelectedBrokerageAccount",{extend:"Ext.util.Observable",config:{value:null},constructor:function(a){this.addEvents({change:true});if(a!=undefined){this.listeners=a}this.callParent(arguments)},setValue:function(a){this.value=a;this.fireEvent("change",a)}});Ext.define("ServerErrorHandler",{singleton:true,SubscribeToAllErrors:function(){var b=EventAggregator.events;for(var a=0;a<b.length;a++){if(b[a].search("Error")==b[a].length-5){EventAggregator.subscribeForever(b[a],ServerErrorHandler.handleError)}}},handleError:function(d,b){if(d==null){ServerErrorHandler.showErrorMessage(Bullsfirst.GlobalConstants.UnknownError);return}if(b.search("store")>=0){ServerErrorHandler.showErrorMessage(Ext.String.format(Bullsfirst.GlobalConstants.StoreLoadError,b.slice(0,b.lastIndexOf("store"))));return}if(d.$className.search(".action.")>=0){switch(b){case"userloginError":ServerErrorHandler.showErrorMessage(Ext.String.format(Bullsfirst.GlobalConstants.UserLoginError,d.response.statusText));break;default:break}return}if(d.$className.search(".Operation")>=0){var c="";if(!Ext.isEmpty(d.customError)){c=d.customError}else{if(d.response!=null&&!Ext.isEmpty(d.response.responseText)){try{var g=JSON.parse(d.response.responseText);if(!Ext.isEmpty(g)&&!Ext.isEmpty(g.detail)){c=g.detail}}catch(f){}}}if(c==""){var a=d.getError();if(a!=null&&!Ext.isEmpty(a.statusText)){c=a.statusText}}if(!Ext.isEmpty(c)){ServerErrorHandler.showErrorMessage(Ext.String.format(Bullsfirst.GlobalConstants.GeneralError,c))}else{ServerErrorHandler.showErrorMessage(Bullsfirst.GlobalConstants.UnknownError)}return}},showErrorMessage:function(a){Ext.Msg.alert(Bullsfirst.GlobalConstants.ErrorTitle,a)}});Ext.define("Bullsfirst.extensions.SubmitActionWithNoResponse",{extend:"Ext.form.action.Submit",processResponse:function(a){this.response=a;return true}});Ext.define("Bullsfirst.extensions.SubmitButton",{extend:"Ext.button.Button",alias:"widget.submitbutton",disabled:true,initComponent:function(){this.callParent()}});Ext.define("Bullsfirst.plugins.LoadMask",{extend:"Ext.AbstractPlugin",alias:"plugin.loadmask",init:function(b){var a;if(b.remoteStore){a=b.remoteStore}else{if(b.store){a=b.store}}var c=new Ext.LoadMask(b,{store:a,msg:Bullsfirst.GlobalConstants.LoadingMessage})}});Ext.Loader.setConfig({enabled:true});Ext.application({name:"Bullsfirst",appFolder:"app",autoCreateViewport:true,controllers:["Bullsfirst.controller.login.LoginController","Bullsfirst.controller.trading.MainController","Bullsfirst.controller.trading.AccountsController","Bullsfirst.controller.trading.PositionsController","Bullsfirst.controller.trading.TradeController","Bullsfirst.controller.trading.OrdersController","Bullsfirst.controller.trading.TransferController","Bullsfirst.controller.trading.TransactionsController"],launch:function(){ServerErrorHandler.SubscribeToAllErrors()}});

<!DOCTYPE html>

<!--
Questions:
1. ????
-->

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Cumulative P&L - Highcharts</title>

    <link rel="stylesheet" type="text/css" href="/libs/style4/css/style4.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css" />

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
    <script type="text/javascript" src="/libs/highcharts-2.1.6/js/highcharts.js"></script>
    <script type="text/javascript" src="/libs/highcharts-2.1.6/js/themes/gray.js"></script>

    <script type="text/javascript">

        var sectors = {};  // create an object called sectors
        var sectorNames = [];
        var chart1;
        var seriesOptions = [];

        $(document).ready(function () {

            // Initialize p&l data by sectors
            $.ajax({
                // have to use synchronous here, else the function 
                // will return before the data is fetched
                async: false,
                url: "cumulative-pnl-weekly-by-sector.json",
                dataType: "json",
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        var sector = getSector(data[i].sector);
                        sector.marketMoves.push([data[i].week, data[i].marketMoves]);
                        sector.newTrades.push([data[i].week, data[i].newTrades]);
                        sector.fees.push([data[i].week, data[i].fees]);
                        sector.total.push([data[i].week, data[i].total]);
                    }
                }
            });

            // Create sector names and populate in sector listbox
            var options = "";
            var selected = ' selected="selected"';
            for (var sectorName in sectors) {
                sectorNames.push(sectorName);
                options += '<option value="' + sectorName + '"' + selected + '>' + sectorName + '</option>';
                selected = "";  // clear selected after first time through the loop
            }
            $('#sectorList').html(options);

            // Plot first sector
            chart1 = new Highcharts.Chart({
                chart: {
                    renderTo: 'chart1',
                    type: 'bar'
                },
                title: {
                    text: 'Fruit Consumption'
                },
                xAxis: {
                    categories: ['Apples', 'Bananas', 'Oranges']
                },
                yAxis: {
                    title: {
                        text: 'Fruit eaten'
                    }
                },
                series: seriesOptions
            });

            seriesOptions.push({ name: 'Jane', data: [1, 0, 4] });

            $('.legendVisibility').click(function () {
                var series_number = 0;
                switch (this.value) {
                    case "market-moves":
                        series_number = 0;
                        break;
                    case "new-trades":
                        series_number = 1;
                        break;
                    case "fees":
                        series_number = 2;
                        break;
                    case "total":
                        series_number = 3;
                        break;
                }
                plot1.series[series_number].show = this.checked;
                plot1.replot();
            });

            $('#sectorList').change(function () {
                alert(this.value);
            });

        });

        function getSector(name) {
            var sector = sectors[name];
            if (sector == null) {

                sector = new Object();
                sector.marketMoves = [];
                sector.newTrades = [];
                sector.fees = [];
                sector.total = [];

                sectors[name] = sector;
            }
            return sector;
        }
  </script>
</head>

<body>
<div id="wrapper">
    <h1>Trade Warehouse</h1>

    <div id="stylefour">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="cumulative-pnl-weekly-by-sector-jqplot.html">Cumulative P&L (jqPlot)</a></li>
            <li><a href="cumulative-pnl-weekly-by-sector-highcharts.html" class="current">Cumulative P&L (Highcharts)</a></li>
        </ul>
    </div>

    <div id="sidebar">
        <select id="sectorList" size="20"></select>
    </div>

    <div id="content">
        <div id="chart1"></div>

        <div id="legend1">
            <input class="legendVisibility" value="total" type="checkbox" checked="checked" /> <img src="images/marker-green.png" alt="cyan" /> Total&nbsp;&nbsp;
            <input class="legendVisibility" value="market-moves" type="checkbox" checked="checked" /> <img src="images/marker-cyan.png" alt="cyan" /> Market Moves&nbsp;&nbsp;
            <input class="legendVisibility" value="new-trades" type="checkbox" checked="checked" /> <img src="images/marker-gold.png" alt="cyan" /> New Trades&nbsp;&nbsp;
            <input class="legendVisibility" value="fees" type="checkbox" checked="checked" /> <img src="images/marker-khaki.png" alt="cyan" /> Fees and Commissions<br />
        </div>
    </div>
</div>
</body>
</html>